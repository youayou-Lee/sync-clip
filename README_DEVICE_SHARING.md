# 剪贴板共享工具 - 设备发现功能

## 概述

本工具是一个跨平台的剪贴板共享应用程序，支持在局域网内自动发现并连接其他设备，实现剪贴板内容的实时同步。

## 新增功能

### 🆕 设备发现和管理
- **自动设备发现**: 启动时自动搜索局域网内的其他运行实例
- **实时设备列表**: 显示所有已连接设备的状态和平台信息
- **设备状态监控**: 实时显示设备在线状态（绿色=在线，橙色=离线）
- **跨平台支持**: 识别Windows、Linux、macOS等不同平台设备
- **设备加入/离开通知**: 当设备加入或离开网络时显示通知

### 🔧 网络增强
- **动态端口绑定**: 自动选择可用端口，避免端口冲突
- **多端口广播**: 同时广播到多个常用端口，提高连接成功率
- **心跳机制**: 定期发送心跳包维持设备连接状态
- **设备超时管理**: 自动清理长时间未响应的设备

## 使用方法

### 基本使用

1. **启动应用程序**
   ```bash
   uv run python main.py
   ```

2. **界面布局**
   - **左侧**: 剪贴板历史记录区域
   - **右侧**: 连接设备列表
   - **底部**: 状态栏

3. **设备信息显示**
   - 设备名称（带平台颜色标识）
   - IP地址
   - 操作系统类型
   - 最后在线时间
   - 在线状态指示器

### 高级功能

1. **手动刷新设备列表**
   - 点击"刷新设备"按钮重新搜索网络中的设备

2. **查看设备详情**
   - Windows设备显示为蓝色
   - Linux设备显示为绿色
   - macOS设备显示为紫色

## 网络配置

### 端口使用
- **默认端口**: 5555
- **广播端口**: 5555-5559 (自动遍历)
- **端口自动分配**: 如果默认端口被占用，自动分配下一个可用端口

### 防火墙设置
确保以下端口在防火墙中允许UDP通信：
- 5555-5559 (UDP广播端口)
- 应用程序实际绑定的端口

## 测试工具

### 多设备测试
```bash
# 在同一台机器上测试多个实例
uv run python multi_device_test.py --instances 2 --duration 30

# 在不同端口上测试
uv run python multi_device_test.py --port 5560 --duration 30

# 指定测试时长
uv run python multi_device_test.py --duration 60
```

### 设备发现测试
```bash
# 单设备网络测试
uv run python simple_device_test.py

# 基本设备发现测试
uv run python test_device_discovery.py
```

## 跨平台使用

### Windows
```bash
# 使用Python虚拟环境
uv run python main.py
```

### Linux
```bash
# 确保安装了必要的依赖
pip install -r requirements.txt
python main.py
```

### macOS
```bash
# 安装依赖并运行
pip install -r requirements.txt
python main.py
```

## 故障排除

### 设备未发现
1. **检查网络连接**: 确保设备在同一局域网内
2. **防火墙设置**: 允许UDP广播通信
3. **端口冲突**: 使用不同的启动端口
4. **重启应用**: 重新启动应用程序触发设备发现

### 连接不稳定
1. **网络延迟**: 检查网络质量
2. **防火墙干扰**: 临时禁用防火墙测试
3. **网络配置**: 检查路由器是否支持UDP广播

### 界面问题
1. **依赖缺失**: 安装所有必需的Python包
2. **权限问题**: 确保有剪贴板访问权限
3. **平台兼容**: 检查是否支持当前操作系统

## 技术细节

### 协议设计
- **通信协议**: UDP广播
- **数据格式**: JSON
- **设备标识**: 主机名 + IP地址
- **图片传输**: Base64编码

### 数据包类型
- `device_announce`: 设备加入通知
- `device_discovery`: 设备发现请求
- `device_heartbeat`: 设备心跳
- `clipboard_data`: 剪贴板数据

### 安全考虑
- **局域网限制**: 仅在本地网络内工作
- **数据传输**: 未加密传输，仅适用于可信网络
- **端口限制**: 使用特定端口范围

## 更新日志

### v2.0.0 - 设备发现版本
- ✅ 添加设备自动发现功能
- ✅ 实现设备列表显示
- ✅ 支持跨平台设备识别
- ✅ 添加设备状态监控
- ✅ 实现动态端口绑定
- ✅ 添加多端口广播支持
- ✅ 实现设备心跳机制
- ✅ 优化用户界面布局

### v1.0.0 - 基础版本
- ✅ 基本剪贴板共享
- ✅ 跨平台支持
- ✅ 文本和图片支持